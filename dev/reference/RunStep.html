<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run a single step in a workflow. — RunStep • gsm.core</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Run a single step in a workflow. — RunStep"><meta name="description" content='
Runs a single step of an assessment workflow. This function is called by RunWorkflow for each
step in the workflow. It prepares the parameters for the function call and then calls the function
specified in lStep$name with the prepared parameters.
The primary utility of this function is to provide a prioritized parser for function parameterization.
Parameters should be specified as a named list in lStep$params, where each element is a key-value pair
that will be parsed and then passed to the specified function as a set of parameter names/values.
Parameter values should be specified as scalar strings. Those values are then pulled from lMeta or lData
when possible. When no matching lData or lMeta objects are found, parameter values are passed through as
strings. Note that parsing vectorized parameters is not supported at this time; they are passed directly
as character vectors. To pass a vector or list, we recommend saving it as an object in lData.
Full prioritization for parsing parameters is below:
If a single parameter value is equal to "lMeta", the the full lMeta object is passed to the function
(for the given paramName).
If a single parameter value is equal to "lData", the full lData object is passed to the function.
If a single parameter value is equal to "lSpec", the full lSpec object is passed to the function.
If a single parameter value is found in names(lMeta), that property is pulled from lMeta (e.g.
lMeta${paramVal}) and passed to the function.
If a single parameter value is found in names(lData), that property is pulled from lData (e.g.
lData${paramVal}) and passed to the function.
Otherwise single parameter value is passed to the function as a string.
If the parameter value is a vector, the vector is passed to the function as a vector or strings.

'><meta property="og:description" content='
Runs a single step of an assessment workflow. This function is called by RunWorkflow for each
step in the workflow. It prepares the parameters for the function call and then calls the function
specified in lStep$name with the prepared parameters.
The primary utility of this function is to provide a prioritized parser for function parameterization.
Parameters should be specified as a named list in lStep$params, where each element is a key-value pair
that will be parsed and then passed to the specified function as a set of parameter names/values.
Parameter values should be specified as scalar strings. Those values are then pulled from lMeta or lData
when possible. When no matching lData or lMeta objects are found, parameter values are passed through as
strings. Note that parsing vectorized parameters is not supported at this time; they are passed directly
as character vectors. To pass a vector or list, we recommend saving it as an object in lData.
Full prioritization for parsing parameters is below:
If a single parameter value is equal to "lMeta", the the full lMeta object is passed to the function
(for the given paramName).
If a single parameter value is equal to "lData", the full lData object is passed to the function.
If a single parameter value is equal to "lSpec", the full lSpec object is passed to the function.
If a single parameter value is found in names(lMeta), that property is pulled from lMeta (e.g.
lMeta${paramVal}) and passed to the function.
If a single parameter value is found in names(lData), that property is pulled from lData (e.g.
lData${paramVal}) and passed to the function.
Otherwise single parameter value is passed to the function as a string.
If the parameter value is a vector, the vector is passed to the function as a vector or strings.

'><meta name="robots" content="noindex"><link href="pkgdown/extra.css" rel="stylesheet"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsm.core</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-sample-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Sample Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-sample-reports"><li><a class="dropdown-item" href="../report_kri_site.html">Site Report</a></li>
    <li><a class="dropdown-item" href="../report_kri_country.html">Country Report</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Gilead-BioStats/gsm.core/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run a single step in a workflow.</h1>
      <small class="dont-index">Source: <a href="https://github.com/Gilead-BioStats/gsm.core/blob/gsm.core-v1.1.0-rc/R/RunStep.R" class="external-link"><code>R/RunStep.R</code></a></small>
      <div class="d-none name"><code>RunStep.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a></p>
<p>Runs a single step of an assessment workflow. This function is called by <code>RunWorkflow</code> for each
step in the workflow. It prepares the parameters for the function call and then calls the function
specified in <code>lStep$name</code> with the prepared parameters.</p>
<p>The primary utility of this function is to provide a prioritized parser for function parameterization.
Parameters should be specified as a named list in <code>lStep$params</code>, where each element is a key-value pair
that will be parsed and then passed to the specified function as a set of parameter names/values.
Parameter values should be specified as scalar strings. Those values are then pulled from <code>lMeta</code> or <code>lData</code>
when possible. When no matching <code>lData</code> or <code>lMeta</code> objects are found, parameter values are passed through as
strings. Note that parsing vectorized parameters is not supported at this time; they are passed directly
as character vectors. To pass a vector or list, we recommend saving it as an object in <code>lData</code>.</p>
<p>Full prioritization for parsing parameters is below:</p><ol><li><p>If a single parameter value is equal to "lMeta", the the full lMeta object is passed to the function
(for the given paramName).</p></li>
<li><p>If a single parameter value is equal to "lData", the full lData object is passed to the function.</p></li>
<li><p>If a single parameter value is equal to "lSpec", the full lSpec object is passed to the function.</p></li>
<li><p>If a single parameter value is found in names(lMeta), that property is pulled from lMeta (e.g.
lMeta${paramVal}) and passed to the function.</p></li>
<li><p>If a single parameter value is found in names(lData), that property is pulled from lData (e.g.
lData${paramVal}) and passed to the function.</p></li>
<li><p>Otherwise single parameter value is passed to the function as a string.</p></li>
<li><p>If the parameter value is a vector, the vector is passed to the function as a vector or strings.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">RunStep</span><span class="op">(</span><span class="va">lStep</span>, <span class="va">lData</span>, <span class="va">lMeta</span>, lSpec <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-lstep">lStep<a class="anchor" aria-label="anchor" href="#arg-lstep"></a></dt>
<dd><p><code>list</code> single workflow step (typically pulled from <code>lWorkflow$steps</code>). Should
include the name of the function to run (<code>lStep$name</code>), name of the object where the function result should be saved (<code>lStep$output</code>) and configurable parameters (<code>lStep$params</code>) (if any)</p></dd>


<dt id="arg-ldata">lData<a class="anchor" aria-label="anchor" href="#arg-ldata"></a></dt>
<dd><p><code>list</code> a named list of domain level data frames.</p></dd>


<dt id="arg-lmeta">lMeta<a class="anchor" aria-label="anchor" href="#arg-lmeta"></a></dt>
<dd><p><code>list</code> a named list of meta data.</p></dd>


<dt id="arg-lspec">lSpec<a class="anchor" aria-label="anchor" href="#arg-lspec"></a></dt>
<dd><p><code>list</code> a data specification containing required columns. See <code><a href="../articles/gsmExtensions.html">vignette("gsmExtensions", package = "gsm.core")</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>list</code> containing the results of the <code>lStep$name</code> function call should contain <code>.$checks</code>
parameter with results from <code>is_mapping_vald</code> for each domain in <code>lStep$inputs</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">wf_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AE"</span>, <span class="st">"SUBJ"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               strPath <span class="op">=</span> <span class="st">"example_workflow/1_mappings"</span>,</span></span>
<span class="r-in"><span>                               strPackage <span class="op">=</span> <span class="st">"gsm.core"</span>,</span></span>
<span class="r-in"><span>                               bExact <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lWorkflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"example_workflow/2_metrics"</span>,</span></span>
<span class="r-in"><span>                              strNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kri0001"</span>, <span class="st">"kri0002"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                              strPackage <span class="op">=</span> <span class="st">"gsm.core"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lStep</span> <span class="op">&lt;-</span> <span class="va">lWorkflow</span><span class="op">[[</span><span class="st">"kri0001"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"steps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">lMeta</span> <span class="op">&lt;-</span> <span class="va">lWorkflow</span><span class="op">[[</span><span class="st">"kri0001"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"meta"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lRaw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>          Raw_SUBJ <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span></span>
<span class="r-in"><span>          Raw_AE <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_AE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">wf_mapping</span>, <span class="va">lRaw</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Running 2 Workflows</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Initializing `Mapped_AE` Workflow</span> <span style="color: #00BBBB;">───────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Checking data against spec </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → All 1 data.frame(s) in the spec are present in the data: Raw_AE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → All specified columns in Raw_AE are in the expected format</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → All 2 specified column(s) in the spec are present in the data: Raw_AE$subjid, Raw_AE$aeser</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Workflow Step 1 of 1: `=`</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Evaluating 2 parameter(s) for `=` </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> lhs = Mapped_AE: No matching data found. Passing 'Mapped_AE' as a string.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> rhs = Raw_AE: Passing lData$Raw_AE.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Calling `=` </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── 3000x7 data.frame saved as `lData$Mapped_AE`. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Returning results from final step: 3000x7 data.frame`.</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Completed `Mapped_AE` Workflow</span> <span style="color: #00BBBB;">──────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Initializing `Mapped_SUBJ` Workflow</span> <span style="color: #00BBBB;">─────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Checking data against spec </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → All 1 data.frame(s) in the spec are present in the data: Raw_SUBJ</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → All specified columns in Raw_SUBJ are in the expected format</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → All 7 specified column(s) in the spec are present in the data: Raw_SUBJ$studyid, Raw_SUBJ$invid, Raw_SUBJ$country, Raw_SUBJ$subjid, Raw_SUBJ$subject_nsv, Raw_SUBJ$enrollyn, Raw_SUBJ$timeonstudy</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Workflow Step 1 of 1: `RunQuery`</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Evaluating 2 parameter(s) for `RunQuery` </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> df = Raw_SUBJ: Passing lData$Raw_SUBJ.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> strQuery = SELECT * FROM df WHERE enrollyn == 'Y': No matching data found. Passing 'SELECT * FROM df WHERE enrollyn == 'Y'' as a string.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Calling `RunQuery` </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating a new temporary DuckDB connection.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> SQL Query complete: 746 rows returned.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Disconnected from temporary DuckDB connection.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── 746x14 data.frame saved as `lData$Mapped_SUBJ`. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Returning results from final step: 746x14 data.frame`.</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Completed `Mapped_SUBJ` Workflow</span> <span style="color: #00BBBB;">────────────────────────────────────────────</span></span>
<span class="r-in"><span><span class="va">ae_step</span> <span class="op">&lt;-</span> <span class="fu">RunStep</span><span class="op">(</span>lStep <span class="op">=</span> <span class="va">lStep</span>, lData <span class="op">=</span> <span class="va">lMapped</span>, lMeta <span class="op">=</span> <span class="va">lMeta</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Evaluating 1 parameter(s) for `ParseThreshold` </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> strThreshold = Threshold: Passing lMeta$Threshold.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Calling `ParseThreshold` </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Parsed -2,-1,2,3 to numeric vector: -2, -1, 2, 3</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Wu, Jeremy Wildfire, Spencer Childress, Laura Maxwell, Jacob Anderson, Jon Harmon, Zelos Zhu, Matt Roumaya, Nathan Kosiba, Douglas Sanders, Li Ge, Zhongkai Wang, Colleen McLaughlin, Chelsea Dickens, Maya Gans, Anne Zheng, Devin Pastoor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>


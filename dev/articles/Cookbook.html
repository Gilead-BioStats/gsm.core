<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cookbook â€¢ gsm.core</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Cookbook">
<meta name="description" content="Sample code showing how to use the Good Statistical Monitoring {gsm} suite of  packages using sample data from {gsm.core}.">
<meta property="og:description" content="Sample code showing how to use the Good Statistical Monitoring {gsm} suite of  packages using sample data from {gsm.core}.">
<meta name="robots" content="noindex">
<link href="pkgdown/extra.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsm.core</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-sample-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Sample Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-sample-reports">
<li><a class="dropdown-item" href="../report_kri_site.html">Site Report</a></li>
    <li><a class="dropdown-item" href="../report_kri_country.html">Country Report</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Gilead-BioStats/gsm.core/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cookbook</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Gilead-BioStats/gsm.core/blob/dev/vignettes/Cookbook.Rmd" class="external-link"><code>vignettes/Cookbook.Rmd</code></a></small>
      <div class="d-none name"><code>Cookbook.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette contains sample code showing how to use the Good
Statistical Monitoring <code>{gsm}</code> suite of packages using sample
data from <a href="https://github.com/Gilead-BioStats/gsm.core" class="external-link">gsm.core</a>. For more information on the
<code>{gsm}</code> suite of packages see the <a href="https://gilead-biostats.github.io/gsm.core/">package
homepage</a>.</p>
</div>
<div class="section level2">
<h2 id="setup-and-installation">Setup and Installation<a class="anchor" aria-label="anchor" href="#setup-and-installation"></a>
</h2>
<p>Run the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Install devtools</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Install and load gsm</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm.core"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Gilead-BioStats/gsm.core" class="external-link">gsm.core</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Install and load gsm.mapping</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm.mapping"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.mapping</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Install and load gsm.kri</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm.kri"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.kri</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Install and load gsm.reporting</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm.reporting"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.kri</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-1---adverse-events-metric---scripted">Example 1 - Adverse Events Metric - Scripted<a class="anchor" aria-label="anchor" href="#example-1---adverse-events-metric---scripted"></a>
</h2>
<p>This example uses the standard {gsm} analysis workflows to creates
site-level Adverse Event scripts. See the <a href="https://gilead-biostats.github.io/gsm.core/articles/DataAnalysis.html">Data
Analysis Vignette</a> for more detail.</p>
<ul>
<li>
<strong>Example 1.1</strong> calculates the Site-level AE
rates.</li>
<li>
<strong>Example 1.2</strong> adds a filter to include only Serious
Adverse Events (SAEs) and implements pipes to run through the
workflow.</li>
<li>
<strong>Example 1.3</strong> generates bar charts showing SAE rates
and z-scores by study using <code>{gsm.kri}</code>.</li>
<li>
<strong>Example 1.4</strong> generates a scatter plot with
confidence bound for SAE rates using <code>{gsm.kri}</code>.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### Example 1.1 - Generate an Adverse Event Metric using the standard {gsm.core} workflow</span></span>
<span></span>
<span><span class="va">dfInput</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Input_Rate.html">Input_Rate</a></span><span class="op">(</span></span>
<span>  dfSubjects<span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span>
<span>  dfNumerator<span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_AE</span>,</span>
<span>  dfDenominator <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span>
<span>  strSubjectCol <span class="op">=</span> <span class="st">"subjid"</span>,</span>
<span>  strGroupCol <span class="op">=</span> <span class="st">"invid"</span>,</span>
<span>  strNumeratorMethod<span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  strDenominatorMethod<span class="op">=</span> <span class="st">"Sum"</span>,</span>
<span>  strDenominatorCol<span class="op">=</span> <span class="st">"timeonstudy"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfTransformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Transform_Rate.html">Transform_Rate</a></span><span class="op">(</span><span class="va">dfInput</span><span class="op">)</span></span>
<span><span class="va">dfAnalyzed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Analyze_NormalApprox.html">Analyze_NormalApprox</a></span><span class="op">(</span><span class="va">dfTransformed</span>, strType <span class="op">=</span> <span class="st">"rate"</span><span class="op">)</span></span>
<span><span class="va">dfFlagged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Flag_NormalApprox.html">Flag_NormalApprox</a></span><span class="op">(</span><span class="va">dfAnalyzed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfSummarized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Summarize.html">Summarize</a></span><span class="op">(</span><span class="va">dfFlagged</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dfSummarized</span><span class="op">$</span><span class="va">Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Example 1.2 - Make an SAE Metric by adding a filter.  Also works with pipes.</span></span>
<span></span>
<span><span class="va">SAE_KRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Input_Rate.html">Input_Rate</a></span><span class="op">(</span></span>
<span>  dfSubjects<span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span>
<span>  dfNumerator<span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_AE</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">aeser</span><span class="op">==</span><span class="st">"Y"</span><span class="op">)</span>,</span>
<span>  dfDenominator <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span>
<span>  strSubjectCol <span class="op">=</span> <span class="st">"subjid"</span>,</span>
<span>  strGroupCol <span class="op">=</span> <span class="st">"invid"</span>,</span>
<span>  strNumeratorMethod<span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  strDenominatorMethod<span class="op">=</span> <span class="st">"Sum"</span>,</span>
<span>  strDenominatorCol<span class="op">=</span> <span class="st">"timeonstudy"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="va">Transform_Rate</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/Analyze_NormalApprox.html">Analyze_NormalApprox</a></span><span class="op">(</span>strType <span class="op">=</span> <span class="st">"rate"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/Flag_NormalApprox.html">Flag_NormalApprox</a></span><span class="op">(</span>vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="va">Summarize</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SAE_KRI</span><span class="op">$</span><span class="va">Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Example 1.3 - Visualize Metric distribution using Bar Charts using provided htmlwidgets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.kri</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Metric<span class="op">=</span> <span class="st">"Serious Adverse Event Rate"</span>,</span>
<span>  Numerator<span class="op">=</span> <span class="st">"Serious Adverse Events"</span>,</span>
<span>  Denominator<span class="op">=</span> <span class="st">"Days on Study"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Widget_BarChart</span><span class="op">(</span>dfResults <span class="op">=</span> <span class="va">SAE_KRI</span>, lMetric<span class="op">=</span><span class="va">labels</span>, strOutcome<span class="op">=</span><span class="st">"Metric"</span><span class="op">)</span></span>
<span><span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Widget_BarChart</span><span class="op">(</span>dfResults <span class="op">=</span> <span class="va">SAE_KRI</span>, lMetric<span class="op">=</span><span class="va">labels</span>, strOutcome<span class="op">=</span><span class="st">"Score"</span><span class="op">)</span></span>
<span><span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Widget_BarChart</span><span class="op">(</span>dfResults <span class="op">=</span> <span class="va">SAE_KRI</span>, lMetric<span class="op">=</span><span class="va">labels</span>, strOutcome<span class="op">=</span><span class="st">"Numerator"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Example 1.4 - Create Scatter plot with confidence bounds</span></span>
<span><span class="va">dfBounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Analyze_NormalApprox_PredictBounds.html">Analyze_NormalApprox_PredictBounds</a></span><span class="op">(</span><span class="va">SAE_KRI</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Widget_ScatterPlot</span><span class="op">(</span><span class="va">SAE_KRI</span>, lMetric <span class="op">=</span> <span class="va">labels</span>, dfBounds <span class="op">=</span> <span class="va">dfBounds</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-2---adverse-events-metrics---workflow">Example 2 - Adverse Events Metrics - Workflow<a class="anchor" aria-label="anchor" href="#example-2---adverse-events-metrics---workflow"></a>
</h2>
<p>This examples introduces YAML workflows to re-generate the same
results as in <strong>Example 1</strong> via a reusable pipeline. See
the <a href="https://gilead-biostats.github.io/gsm.core/articles/DataModel.html">Data
Model Vignette</a> for more detail.</p>
<ul>
<li>
<strong>Example 2.1</strong> runs the AE KRI workflow.</li>
<li>
<strong>Example 2.2</strong> updates the metadata to run
country-level metrics.</li>
<li>
<strong>Example 2.3</strong> adds a filtering step to the workflow
to generate the SAE metric.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.mapping</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.kri</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Example 2.1 - Configurable Adverse Event Workflow</span></span>
<span></span>
<span><span class="co"># Define YAML workflow</span></span>
<span><span class="va">AE_workflow</span> <span class="op">&lt;-</span> <span class="fu">read_yaml</span><span class="op">(</span>text<span class="op">=</span></span>
<span><span class="st">'meta:</span></span>
<span><span class="st">  Type: Analysis</span></span>
<span><span class="st">  ID: kri0001</span></span>
<span><span class="st">  GroupLevel: Site</span></span>
<span><span class="st">  Abbreviation: AE</span></span>
<span><span class="st">  Metric: Adverse Event Rate</span></span>
<span><span class="st">  Numerator: Adverse Events</span></span>
<span><span class="st">  Denominator: Days on Study</span></span>
<span><span class="st">  Model: Normal Approximation</span></span>
<span><span class="st">  Score: Adjusted Z-Score</span></span>
<span><span class="st">  AnalysisType: rate</span></span>
<span><span class="st">  Threshold: -2,-1,2,3</span></span>
<span><span class="st">  AccrualThreshold: 30</span></span>
<span><span class="st">  AccrualMetric: Denominator</span></span>
<span><span class="st">spec:</span></span>
<span><span class="st">  Mapped_AE:</span></span>
<span><span class="st">    subjid:</span></span>
<span><span class="st">      type: character</span></span>
<span><span class="st">  Mapped_SUBJ:</span></span>
<span><span class="st">    subjid:</span></span>
<span><span class="st">      type: character</span></span>
<span><span class="st">    invid:</span></span>
<span><span class="st">      type: character</span></span>
<span><span class="st">    timeonstudy:</span></span>
<span><span class="st">      type: integer</span></span>
<span><span class="st">steps:</span></span>
<span><span class="st">  - output: vThreshold</span></span>
<span><span class="st">    name: ParseThreshold</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      strThreshold: Threshold</span></span>
<span><span class="st">  - output: Analysis_Input</span></span>
<span><span class="st">    name: Input_Rate</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      dfSubjects: Mapped_SUBJ</span></span>
<span><span class="st">      dfNumerator: Mapped_AE</span></span>
<span><span class="st">      dfDenominator: Mapped_SUBJ</span></span>
<span><span class="st">      strSubjectCol: subjid</span></span>
<span><span class="st">      strGroupCol: invid</span></span>
<span><span class="st">      strGroupLevel: GroupLevel</span></span>
<span><span class="st">      strNumeratorMethod: Count</span></span>
<span><span class="st">      strDenominatorMethod: Sum</span></span>
<span><span class="st">      strDenominatorCol: timeonstudy</span></span>
<span><span class="st">  - output: Analysis_Transformed</span></span>
<span><span class="st">    name: Transform_Rate</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      dfInput: Analysis_Input</span></span>
<span><span class="st">  - output: Analysis_Analyzed</span></span>
<span><span class="st">    name: Analyze_NormalApprox</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      dfTransformed: Analysis_Transformed</span></span>
<span><span class="st">      strType: AnalysisType</span></span>
<span><span class="st">  - output: Analysis_Flagged</span></span>
<span><span class="st">    name: Flag_NormalApprox</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      dfAnalyzed: Analysis_Analyzed</span></span>
<span><span class="st">      vThreshold: vThreshold</span></span>
<span><span class="st">      nAccrualThreshold: AccrualThreshold</span></span>
<span><span class="st">      strAccrualMetric: AccrualMetric</span></span>
<span><span class="st">  - output: Analysis_Summary</span></span>
<span><span class="st">    name: Summarize</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      dfFlagged: Analysis_Flagged</span></span>
<span><span class="st">  - output: lAnalysis</span></span>
<span><span class="st">    name: list</span></span>
<span><span class="st">    params:</span></span>
<span><span class="st">      ID: ID</span></span>
<span><span class="st">      Analysis_Input: Analysis_Input</span></span>
<span><span class="st">      Analysis_Transformed: Analysis_Transformed</span></span>
<span><span class="st">      Analysis_Analyzed: Analysis_Analyzed</span></span>
<span><span class="st">      Analysis_Flagged: Analysis_Flagged</span></span>
<span><span class="st">      Analysis_Summary: Analysis_Summary</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the workflow</span></span>
<span><span class="va">lMappingWorkflows</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span></span>
<span>  strNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AE"</span>, <span class="st">"SUBJ"</span><span class="op">)</span>,</span>
<span>  strPath <span class="op">=</span> <span class="st">"workflow/1_mappings"</span>,</span>
<span>  strPackage <span class="op">=</span> <span class="st">"gsm.mapping"</span>,</span>
<span>  bExact <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mappings_spec</span> <span class="op">&lt;-</span> <span class="fu">gsm.mapping</span><span class="fu">::</span><span class="fu">CombineSpecs</span><span class="op">(</span><span class="va">lMappingWorkflows</span><span class="op">)</span></span>
<span><span class="va">lRawData</span> <span class="op">&lt;-</span> <span class="fu">gsm.mapping</span><span class="fu">::</span><span class="fu">Ingest</span><span class="op">(</span><span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span>, <span class="va">mappings_spec</span><span class="op">)</span></span>
<span><span class="va">AE_data</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Mapped_SUBJ<span class="op">=</span> <span class="va">lRawData</span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span>
<span>  Mapped_AE<span class="op">=</span> <span class="va">lRawData</span><span class="op">$</span><span class="va">Raw_AE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">AE_KRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunWorkflow.html">RunWorkflow</a></span><span class="op">(</span>lWorkflow <span class="op">=</span> <span class="va">AE_workflow</span>, lData <span class="op">=</span> <span class="va">AE_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create Barchart from workflow</span></span>
<span><span class="fu">Widget_BarChart</span><span class="op">(</span>dfResults <span class="op">=</span> <span class="va">AE_KRI</span><span class="op">$</span><span class="va">Analysis_Summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Example 2.2 - Run Country-Level Metric</span></span>
<span><span class="va">AE_country_workflow</span> <span class="op">&lt;-</span> <span class="va">AE_workflow</span></span>
<span><span class="va">AE_country_workflow</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">GroupLevel</span> <span class="op">&lt;-</span> <span class="st">"Country"</span></span>
<span><span class="va">AE_country_workflow</span><span class="op">$</span><span class="va">steps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">strGroupCol</span> <span class="op">&lt;-</span> <span class="st">"country"</span></span>
<span></span>
<span><span class="va">AE_country_KRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunWorkflow.html">RunWorkflow</a></span><span class="op">(</span>lWorkflow <span class="op">=</span> <span class="va">AE_country_workflow</span>, lData <span class="op">=</span> <span class="va">AE_data</span><span class="op">)</span></span>
<span><span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Widget_BarChart</span><span class="op">(</span>dfResults <span class="op">=</span> <span class="va">AE_country_KRI</span><span class="op">$</span><span class="va">Analysis_Summary</span>, lMetric <span class="op">=</span> <span class="va">AE_country_workflow</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Example 2.3 - Create SAE workflow</span></span>
<span></span>
<span><span class="co"># Tweak AE workflow metadata</span></span>
<span><span class="va">SAE_workflow</span> <span class="op">&lt;-</span> <span class="va">AE_workflow</span></span>
<span><span class="va">SAE_workflow</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">File</span> <span class="op">&lt;-</span> <span class="st">"SAE_KRI"</span></span>
<span><span class="va">SAE_workflow</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">Metric</span> <span class="op">&lt;-</span> <span class="st">"Serious Adverse Event Rate"</span></span>
<span><span class="va">SAE_workflow</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">Numerator</span> <span class="op">&lt;-</span> <span class="st">"Serious Adverse Events"</span></span>
<span></span>
<span><span class="co"># Add a step to filter out non-serious AEs `RunQuery`</span></span>
<span><span class="va">filterStep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"RunQuery"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"Mapped_AE"</span>,</span>
<span>  params<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    df<span class="op">=</span> <span class="st">"Mapped_AE"</span>,</span>
<span>    strQuery <span class="op">=</span> <span class="st">"SELECT * FROM df WHERE aeser = 'Y'"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">SAE_workflow</span><span class="op">$</span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="va">SAE_workflow</span><span class="op">$</span><span class="va">steps</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">filterStep</span>, after<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the updated workflow</span></span>
<span><span class="va">SAE_KRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunWorkflow.html">RunWorkflow</a></span><span class="op">(</span>lWorkflow <span class="op">=</span> <span class="va">SAE_workflow</span>, lData <span class="op">=</span> <span class="va">AE_data</span> <span class="op">)</span></span>
<span><span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Widget_BarChart</span><span class="op">(</span>dfResults <span class="op">=</span> <span class="va">SAE_KRI</span><span class="op">$</span><span class="va">Analysis_Summary</span>, lMetric <span class="op">=</span> <span class="va">SAE_workflow</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-3---study-level-reporting-workflows">Example 3 - Study-Level Reporting Workflows<a class="anchor" aria-label="anchor" href="#example-3---study-level-reporting-workflows"></a>
</h2>
<p>This example extends the previous examples to generate charts and
reports for multiple KRIs. See the <a href="https://gilead-biostats.github.io/gsm.reporting/articles/DataReporting.html" class="external-link">Data
Reporting Vignette</a> for more detail.</p>
<ul>
<li>
<strong>Example 3.1</strong> steps through several workflows to
generate a report for all 12 standard site-level KRIs.</li>
<li>
<strong>Example 3.2</strong> automates data ingestion using
<code>gsm.mapping::Ingest()</code> and
<code>gsm.mapping::CombineSpecs()</code>.</li>
<li>
<strong>Example 3.3</strong> generates a report using
<code>{gsm.kri}</code> incorporating multiple timepoints using the
sample <code>reporting</code> data saved as part of
<a href="https://github.com/Gilead-BioStats/gsm.core" class="external-link">gsm.core</a>.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Gilead-BioStats/gsm.core" class="external-link">gsm.core</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.mapping</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.kri</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gsm.reporting</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### 3.1 - Create a KRI Report using 13 standard metrics in a step-by-step workflow</span></span>
<span></span>
<span><span class="va">core_mappings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AE"</span>, <span class="st">"COUNTRY"</span>, <span class="st">"DATACHG"</span>, <span class="st">"DATAENT"</span>, <span class="st">"ENROLL"</span>, <span class="st">"LB"</span>, <span class="st">"PK"</span>,</span>
<span>                   <span class="st">"PD"</span>, <span class="st">"QUERY"</span>, <span class="st">"STUDY"</span>, <span class="st">"STUDCOMP"</span>, <span class="st">"SDRGCOMP"</span>, <span class="st">"SITE"</span>, <span class="st">"SUBJ"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 0 - Create Raw Data from Source Data</span></span>
<span><span class="va">lRaw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Raw_SUBJ <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SUBJ</span>,</span>
<span>  Raw_AE <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_AE</span>,</span>
<span>  Raw_PD <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_PD</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subjid <span class="op">=</span> <span class="va">subjectenrollmentnumber</span><span class="op">)</span>,</span>
<span>  Raw_PK <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_PK</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>visit <span class="op">=</span> <span class="va">foldername</span><span class="op">)</span>,</span>
<span>  Raw_LB <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_LB</span>,</span>
<span>  Raw_STUDCOMP <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_STUDCOMP</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subjid</span>, <span class="va">compyn</span><span class="op">)</span>,</span>
<span>  Raw_SDRGCOMP <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SDRGCOMP</span>,</span>
<span>  Raw_DATACHG <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_DATACHG</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subject_nsv <span class="op">=</span> <span class="va">subjectname</span><span class="op">)</span>,</span>
<span>  Raw_DATAENT <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_DATAENT</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subject_nsv <span class="op">=</span> <span class="va">subjectname</span><span class="op">)</span>,</span>
<span>  Raw_QUERY <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_QUERY</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subject_nsv <span class="op">=</span> <span class="va">subjectname</span><span class="op">)</span>,</span>
<span>  Raw_ENROLL <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_ENROLL</span>,</span>
<span>  Raw_SITE <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_SITE</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>studyid <span class="op">=</span> <span class="va">protocol</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>invid <span class="op">=</span> <span class="va">pi_number</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>InvestigatorFirstName <span class="op">=</span> <span class="va">pi_first_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>InvestigatorLastName <span class="op">=</span> <span class="va">pi_last_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>City <span class="op">=</span> <span class="va">city</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>State <span class="op">=</span> <span class="va">state</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="va">country</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Status <span class="op">=</span> <span class="va">site_status</span><span class="op">)</span>,</span>
<span>  Raw_STUDY <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_STUDY</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>studyid <span class="op">=</span> <span class="va">protocol_number</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Status <span class="op">=</span> <span class="va">status</span><span class="op">)</span>,</span>
<span>  Raw_VISIT <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span><span class="op">$</span><span class="va">Raw_VISIT</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>visit_folder <span class="op">=</span> <span class="va">foldername</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>visit <span class="op">=</span> <span class="va">foldername</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1 - Create Mapped Data Layer - filter, aggregate and join raw data to create mapped data layer</span></span>
<span><span class="va">mappings_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strNames <span class="op">=</span> <span class="va">core_mappings</span>, strPath <span class="op">=</span> <span class="st">"workflow/1_mappings"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.mapping"</span><span class="op">)</span></span>
<span><span class="va">mapped</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">mappings_wf</span>, <span class="va">lRaw</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2 - Create Metrics - calculate metrics using mapped data</span></span>
<span><span class="va">metrics_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"workflow/2_metrics"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.kri"</span><span class="op">)</span></span>
<span><span class="va">analyzed</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">metrics_wf</span>, <span class="va">mapped</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3 - Create Reporting Layer - create reports using metrics data</span></span>
<span><span class="va">reporting_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"workflow/3_reporting"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.reporting"</span><span class="op">)</span></span>
<span><span class="va">reporting</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">reporting_wf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mapped</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lAnalyzed <span class="op">=</span> <span class="va">analyzed</span>, lWorkflows <span class="op">=</span> <span class="va">metrics_wf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 4 - Create KRI Reports - create KRI report using reporting data</span></span>
<span><span class="va">module_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"workflow/4_modules"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.kri"</span><span class="op">)</span></span>
<span><span class="va">lReports</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">module_wf</span>, <span class="va">reporting</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### 3.2 - Automate data ingestion using Ingest() and CombineSpecs()</span></span>
<span><span class="co"># Step 0 - Data Ingestion - standardize tables/columns names</span></span>
<span><span class="va">mappings_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strNames <span class="op">=</span> <span class="va">core_mappings</span>, strPath <span class="op">=</span> <span class="st">"workflow/1_mappings"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.mapping"</span><span class="op">)</span></span>
<span><span class="va">mappings_spec</span> <span class="op">&lt;-</span> <span class="fu">gsm.mapping</span><span class="fu">::</span><span class="fu">CombineSpecs</span><span class="op">(</span><span class="va">mappings_wf</span><span class="op">)</span></span>
<span><span class="va">lRaw</span> <span class="op">&lt;-</span> <span class="fu">gsm.mapping</span><span class="fu">::</span><span class="fu">Ingest</span><span class="op">(</span><span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/lSource.html">lSource</a></span>, <span class="va">mappings_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1 - Create Mapped Data Layer - filter, aggregate and join raw data to create mapped data layer</span></span>
<span><span class="va">mapped</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">mappings_wf</span>, <span class="va">lRaw</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2 - Create Metrics - calculate metrics using mapped data</span></span>
<span><span class="va">metrics_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"workflow/2_metrics"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.kri"</span><span class="op">)</span></span>
<span><span class="va">analyzed</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">metrics_wf</span>, <span class="va">mapped</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3 - Create Reporting Layer - create reports using metrics data</span></span>
<span><span class="va">reporting_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"workflow/3_reporting"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.reporting"</span><span class="op">)</span></span>
<span><span class="va">reporting</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">reporting_wf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mapped</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lAnalyzed <span class="op">=</span> <span class="va">analyzed</span>, lWorkflows <span class="op">=</span> <span class="va">metrics_wf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 4 - Create KRI Report - create KRI report using reporting data</span></span>
<span><span class="va">module_wf</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/MakeWorkflowList.html">MakeWorkflowList</a></span><span class="op">(</span>strPath <span class="op">=</span> <span class="st">"workflow/4_modules"</span>, strPackage <span class="op">=</span> <span class="st">"gsm.kri"</span><span class="op">)</span></span>
<span><span class="va">lReports</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">module_wf</span>, <span class="va">reporting</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#### 3.3 Site-Level KRI Report with multiple SnapshotDate</span></span>
<span><span class="co"># Below relies on the clindata stuff, do we need to rerun/rewrite reporting datasets?</span></span>
<span><span class="va">lCharts</span> <span class="op">&lt;-</span> <span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">MakeCharts</span><span class="op">(</span></span>
<span>  dfResults <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingResults.html">reportingResults</a></span>,</span>
<span>  dfGroups <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingGroups.html">reportingGroups</a></span>,</span>
<span>  dfMetrics <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingMetrics.html">reportingMetrics</a></span>,</span>
<span>  dfBounds <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingBounds.html">reportingBounds</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">kri_report_path</span> <span class="op">&lt;-</span> <span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">Report_KRI</span><span class="op">(</span></span>
<span>  lCharts <span class="op">=</span> <span class="va">lCharts</span>,</span>
<span>  dfResults <span class="op">=</span>  <span class="fu">gsm.kri</span><span class="fu">::</span><span class="fu">FilterByLatestSnapshotDate</span><span class="op">(</span><span class="va">reportingResults</span><span class="op">)</span>,</span>
<span>  dfGroups <span class="op">=</span>  <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingGroups.html">reportingGroups</a></span>,</span>
<span>  dfMetrics <span class="op">=</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingMetrics.html">reportingMetrics</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### 3.4 Reporting Results with Changes from previous snapshot</span></span>
<span></span>
<span><span class="co"># Prepare historical data</span></span>
<span><span class="va">historical</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="va"><a href="../reference/reportingResults.html">reportingResults</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SnapshotDate</span> <span class="op">==</span> <span class="st">"2025-03-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-run reporting model and KRI report with historical data</span></span>
<span><span class="va">reporting_long</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">reporting_wf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mapped</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lAnalyzed <span class="op">=</span> <span class="va">analyzed</span>, Reporting_Results_Longitudinal <span class="op">=</span> <span class="va">historical</span>, lWorkflows <span class="op">=</span> <span class="va">metrics_wf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lReports_long</span> <span class="op">&lt;-</span> <span class="fu">gsm.core</span><span class="fu">::</span><span class="fu"><a href="../reference/RunWorkflows.html">RunWorkflows</a></span><span class="op">(</span><span class="va">module_wf</span>, <span class="va">reporting_long</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jeremy Wildfire, George Wu, Spencer Childress, Laura Maxwell, Jacob Anderson, Jon Harmon, Zelos Zhu, Matt Roumaya, Anne Zheng, Devin Pastoor, Nathan Kosiba, Douglas Sanders, Li Ge, Zhongkai Wang, Colleen McLaughlin, Chelsea Dickens, Maya Gans.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
